<!DOCTYPE html>
<header>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>System information</title>
	<style>
		div#shadow {background-color:rgba(0,0,0,0.8); z-index:2000; width:100%; height:100%; position:absolute; left:0; top:0;}
		div#shadow div {position: absolute; top: 50%; transform: translate(-50%, -50%); left: 50%; margin-right: -50%; font-size: x-large; color: yellow;}
	</style>
	<link rel="stylesheet" href="styles.css">
	<link rel="icon" href="favicon.ico">
	<link rel="shortcut icon" sizes="192x192" href="android-icon.png">
	<link rel="apple-touch-icon" href="apple-touch-icon.png">
	<script src="functions.js" type="text/javascript" encoding="UTF-8"></script>
</header>
<html>
	<body>
		<div class="head">
			Управление часами.
			<div>Системная информация</div>
		</div>
		<div class="content">
			<div class="content">
				<div class="holder narrow">
					<div class="row">
						<div>Uptime</div>
						<div id="Uptime"></div>
					</div>
					<div class="row">
						<div>Time</div>
						<div id="Time"></div>
					</div>
					<div class="row">
						<div>Date</div>
						<div id="Date"></div>
					</div>
					<div class="row">
						<div>Sunrise</div>
						<div id="Sunrise"></div>
					</div>
					<div class="row">
						<div>Sunset</div>
						<div id="Sunset"></div>
					</div>
					<div class="row">
						<div>Illumination</div>
						<div id="Illumination"></div>
					</div>
					<div class="row">
						<div>Led Brightness</div>
						<div id="LedBrightness"></div>
					</div>
					<div class="row">
						<div>Power</div>
						<div><span id="fl_5v"></span></div>
					</div>
					<div class="row">
						<div>WiFi RSSI</div>
						<div id="Rssi"></div>
					</div>
					<div class="row">
						<div>Free Heap</div>
						<div><span id="FreeHeap"></span>&nbsp;bytes</div>
					</div>
					<div class="row">
						<div>Max Free Block Size</div>
						<div><span id="MaxFreeBlockSize"></span>&nbsp;bytes</div>
					</div>
					<div class="row">
						<div>Heap Fragmentation</div>
						<div><span id="HeapFragmentation"></span>&nbsp;%</div>
					</div>
					<div class="row">
						<div>Cpu Freq</div>
						<div><span id="CpuFreqMHz"></span>&nbsp;MHz</div>
					</div>
					<div class="row">
						<div>Reset Reason</div>
						<div id="ResetReason"></div>
					</div>
					<div class="row">
						<div>Platform Version</div>
						<div id="FullVersion"></div>
					</div>
				</div>
	
			<button onclick="getInfo()">Обновить</button>
		</div>
		<div class="footer">
			<a href="maintenance.html">Вернуться</a>
		</div>
		<div id="shadow"><div>Загрузка...</div></div>
	</body>
<script type="text/javascript" encoding="UTF-8">
function parseInfo(doc) {
	for (var key in doc) {
		var t = $g(key);
		if(!t) continue;
		switch(key) {
			case "Uptime": t.innerHTML = doc[key].replace(/,/g, "<br>"); break;
			case "Time": t.innerHTML = doc[key].replace(/(\d+)\D(\d+)/g, "$1:$2"); break;
			case "fl_5v": t.innerHTML = doc[key] ? "Main": "Reserve"; break;
			case "FullVersion": t.innerHTML = doc[key].replace(/\//g, "<br>"); break;
			default: t.innerHTML = doc[key];
		}
	}
}
function getInfo(cbfunc=null) {
	ajaxRequest("sysinfo","GET",null, function(ajaxResp) {
		parseInfo(JSON.parse(ajaxResp.responseText));
		if(cbfunc !== null) cbfunc();
	}, dummy);
}
function start() {
	if (typeof ajaxRequest !== "undefined") {
		getInfo( () => {
			$g("shadow").style.display = "none";
		});
	} else setTimeout(start, 100);
}
start();
</script>
</html>